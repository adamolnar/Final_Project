{% extends "base.html" %}
{% load static %}
{% load cloudinary %}

{% block content %}
<div class="container">
    <h1 class="page-title mb-4 mt-4">All Bloggers</h1>

    <div class="row">
        {% if page_obj.has_other_pages %}
            {% for author in page_obj %}
                <div class="col-lg-4 col-md-6 col-sm-12 mb-4">
                    <div class="card p-3" style="height: 450px;">
                        <!-- Author Profile Image -->
                        {% if author.profile.image %}
                            {% cloudinary author.profile.image.url alt='profile-picture' format="jpg" width=100 height=100 crop="fill" class="img-fluid img-thumbnail mt-2 mb-2" style="height:100px; width:100px; z-index: 1" %}
                        {% else %}
                            {% cloudinary "v1704034646/static/images/avatar.b2e01619cc46" alt='profile-picture' format="png" width=150 height=150 crop="fill" class="img-fluid img-thumbnail mt-4 mb-2" style="width: 150px; z-index: 1" %}
                        {% endif %}
                        <!-- Author Name -->
                        <h2><a href="{% url 'author-detail' author.pk %}">{{ author }}</a></h2>
                        
                        <!-- Author About -->
                        <p class="author-about" style="margin-bottom: 0;"><strong>About: </strong>{{ author.profile.about_me|truncatewords_html:5 }}</p>
                        <hr>

                        <!-- Author Posts -->
                        <div class="author-posts">
                            <p style="margin-bottom: 0;"><strong>Latest posts:</strong> </p>
                            {% for post in author.blog_posts.all %}
                                {% if post.status == 1 %}  
                                    {% if forloop.counter <= 3 %} {# Display up to 3 posts in one column #}
                                        <div class="post mt-2">
                                            <!-- Post Image -->
                                            {% if post.image %}
                                                {% cloudinary post.image alt=post.title width=40 height=40 crop="fill"  %}
                                            {% else %}
                                                <img src="https://res.cloudinary.com/dmg7oqpgs/image/upload/v1698830526/Project_4/masthead_wxqbsd.jpg"
                                                    alt="Generic placeholder image"
                                                    style="width: 150px; z-index: 1" crop="fill">
                                            {% endif %}
                                            
                                            <!-- Post Title -->
                                            <a href="{% url 'post-detail' post.slug %}" class="post-title">{{ post.title|truncatewords_html:5 }}</a>
                                        </div>
                                    {% endif %}
                                {% endif %} 
                            {% endfor %}
                        </div>
                    </div>
                </div>
            {% endfor %}
        {% else %}
            <p>No bloggers found.</p>
        {% endif %}
    </div>

    <!-- Pagination Controls -->
    <div class="pagination justify-content-center my-4">
            <ul class="pagination">
                {% if page_obj.has_previous %}
                    <li class="page-item"><a class="page-link" href="?page={{ page_obj.previous_page_number }}" style="color: black;">Previous</a></li>
                {% endif %}

                <li class="page-item disabled"><span class="page-link">Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}.</span></li>

                {% if page_obj.has_next %}
                    <li class="page-item"><a class="page-link" href="?page={{ page_obj.next_page_number }}" style="color: black;">Next</a></li>
                {% endif %}
            </ul>
        </div>
</div>
{% endblock %}
